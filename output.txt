(rag_cuda) PS C:\PythonProjects\RAG-BOT> python scripts/router_eval.py --questions_file queries.txt --debug
INFO Use pytorch device_name: cuda:0
INFO Load pretrained SentenceTransformer: all-MiniLM-L6-v2
INFO Using sentence-transformers backend (all-MiniLM-L6-v2).
question        mode    selected_backend        intent  confidence      allowed_tags    top_docs
INFO router_auto_decision=rules_confident intent=processing_time conf=0.80 allowed_tags=china,visa rule=processing_terms:days
INFO Processing chunk filter kept=29 dropped=34 matches=rag_corpus_main_page_txt-chunk-0001:business day,rag_corpus_visas_china_csv-row-0009:business day,rag_corpus_main_page_txt-chunk-0006:express,rag_corpus_visas_categories_txt-chunk-0009:days,rag_corpus_visas_categories_txt-chunk-0011:days,rag_corpus_visas_categories_table_csv-row-0013:days,rag_corpus_visas_categories_table_csv-row-0011:term,rag_corpus_visas_categories_table_csv-row-0007:days,rag_corpus_visas_categories_table_csv-row-0008:days,rag_corpus_visas_categories_table_csv-row-0009:days,rag_corpus_visas_categories_table_csv-row-0014:term,rag_corpus_visas_categories_table_csv-row-0012:term,rag_corpus_visas_categories_table_csv-row-0006:term,rag_corpus_main_page_txt-chunk-0002:days,rag_corpus_main_page_txt-chunk-0003:days,rag_corpus_visas_categories_txt-chunk-0005:days,rag_corpus_visas_categories_txt-chunk-0006:term,rag_corpus_main_page_txt-chunk-0004:processing time,rag_corpus_personal_data_consent_txt-chunk-0007:express,rag_corpus_personal_data_consent_txt-chunk-0008:express,rag_corpus_personal_data_consent_txt-chunk-0004:processing,rag_corpus_personal_data_consent_txt-chunk-0010:processing,rag_corpus_personal_data_consent_txt-chunk-0003:processing,rag_corpus_main_page_txt-chunk-0005:processing,rag_corpus_personal_data_consent_txt-chunk-0001:processing,rag_corpus_personal_data_consent_txt-chunk-0012:processing,rag_corpus_personal_data_consent_txt-chunk-0013:processing,rag_corpus_personal_data_consent_txt-chunk-0002:processing,rag_corpus_personal_data_consent_txt-chunk-0011:processing
INFO Router intent=processing_time conf=0.80 rule=processing_terms:days backend=rules allowed_tags=china,visa shortlisted=rag_corpus_main_page_txt,rag_corpus_visas_categories_txt,rag_corpus_visas_china_csv,rag_corpus_visas_categories_table_csv,rag_corpus_personal_data_consent_txt top_score=0.926
INFO Router trace backend_requested=rules selected_backend=rules rules_confident=True shortlist=5 top_doc_score=0.926 top2_doc_score=1.000 filter_warning=True fallback_reasons=doc filter broadened (insufficient candidates)     
Do I need a visa for 20 days in China?  rules   rules   processing_time 0.80    china,visa      rag_corpus_main_page_txt,rag_corpus_visas_categories_txt,rag_corpus_visas_china_csv
INFO router_auto_decision=rules_confident intent=processing_time conf=0.80 allowed_tags=china,visa rule=processing_terms:days
INFO Processing chunk filter kept=29 dropped=34 matches=rag_corpus_main_page_txt-chunk-0001:business day,rag_corpus_visas_china_csv-row-0009:business day,rag_corpus_main_page_txt-chunk-0006:express,rag_corpus_visas_categories_txt-chunk-0009:days,rag_corpus_visas_categories_txt-chunk-0011:days,rag_corpus_visas_categories_table_csv-row-0013:days,rag_corpus_visas_categories_table_csv-row-0011:term,rag_corpus_visas_categories_table_csv-row-0007:days,rag_corpus_visas_categories_table_csv-row-0008:days,rag_corpus_visas_categories_table_csv-row-0009:days,rag_corpus_visas_categories_table_csv-row-0014:term,rag_corpus_visas_categories_table_csv-row-0012:term,rag_corpus_visas_categories_table_csv-row-0006:term,rag_corpus_main_page_txt-chunk-0002:days,rag_corpus_main_page_txt-chunk-0003:days,rag_corpus_visas_categories_txt-chunk-0005:days,rag_corpus_visas_categories_txt-chunk-0006:term,rag_corpus_main_page_txt-chunk-0004:processing time,rag_corpus_personal_data_consent_txt-chunk-0007:express,rag_corpus_personal_data_consent_txt-chunk-0008:express,rag_corpus_personal_data_consent_txt-chunk-0004:processing,rag_corpus_personal_data_consent_txt-chunk-0010:processing,rag_corpus_personal_data_consent_txt-chunk-0003:processing,rag_corpus_main_page_txt-chunk-0005:processing,rag_corpus_personal_data_consent_txt-chunk-0001:processing,rag_corpus_personal_data_consent_txt-chunk-0012:processing,rag_corpus_personal_data_consent_txt-chunk-0013:processing,rag_corpus_personal_data_consent_txt-chunk-0002:processing,rag_corpus_personal_data_consent_txt-chunk-0011:processing
INFO Router intent=processing_time conf=0.80 rule=processing_terms:days backend=rules allowed_tags=china,visa shortlisted=rag_corpus_main_page_txt,rag_corpus_visas_categories_txt,rag_corpus_visas_china_csv,rag_corpus_visas_categories_table_csv,rag_corpus_personal_data_consent_txt top_score=0.926
INFO Router trace backend_requested=auto selected_backend=rules rules_confident=True shortlist=5 top_doc_score=0.926 top2_doc_score=1.000 filter_warning=True fallback_reasons=doc filter broadened (insufficient candidates)      
Do I need a visa for 20 days in China?  auto    rules   processing_time 0.80    china,visa      rag_corpus_main_page_txt,rag_corpus_visas_categories_txt,rag_corpus_visas_china_csv
INFO router_auto_decision=rules_confident intent=processing_time conf=0.80 allowed_tags=china,visa rule=processing_terms:days
INFO HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO llm_router_rationale=The question pertains to visa requirements for China, but does not fit neatly into the provided intents.
INFO Router intent=none conf=0.80 rule=llm_router backend=llm allowed_tags=china,visa shortlisted=rag_corpus_visas_categories_txt,rag_corpus_consulate_faq_txt,rag_corpus_visas_china_csv,rag_corpus_visas_taiwan_csv,rag_corpus_consulate_contacts_txt,rag_corpus_form_china_csv,rag_corpus_visas_categories_table_csv,rag_corpus_visas_japan_csv top_score=0.606
INFO Router trace backend_requested=llm selected_backend=llm rules_confident=True shortlist=8 top_doc_score=0.606 top2_doc_score=0.606 filter_warning=False fallback_reasons=none
Do I need a visa for 20 days in China?  llm     llm     none    0.80    china,visa      rag_corpus_visas_categories_txt,rag_corpus_consulate_faq_txt,rag_corpus_visas_china_csv
INFO router_auto_decision=rules_confident intent=delivery conf=0.85 allowed_tags=legalization rule=delivery_keywords
INFO Router intent=delivery conf=0.85 rule=delivery_keywords backend=rules allowed_tags=legalization shortlisted=rag_corpus_main_page_txt,rag_corpus_personal_data_consent_txt top_score=0.566
INFO Router trace backend_requested=rules selected_backend=rules rules_confident=True shortlist=2 top_doc_score=0.566 top2_doc_score=0.313 filter_warning=True fallback_reasons=doc filter broadened (insufficient candidates)     
What documents apply to apostille vs legalization?      rules   rules   delivery        0.85    legalization    rag_corpus_main_page_txt,rag_corpus_personal_data_consent_txt
INFO router_auto_decision=rules_confident intent=delivery conf=0.85 allowed_tags=legalization rule=delivery_keywords
INFO Router intent=delivery conf=0.85 rule=delivery_keywords backend=rules allowed_tags=legalization shortlisted=rag_corpus_main_page_txt,rag_corpus_personal_data_consent_txt top_score=0.566
INFO Router trace backend_requested=auto selected_backend=rules rules_confident=True shortlist=2 top_doc_score=0.566 top2_doc_score=0.313 filter_warning=True fallback_reasons=doc filter broadened (insufficient candidates)      
What documents apply to apostille vs legalization?      auto    rules   delivery        0.85    legalization    rag_corpus_main_page_txt,rag_corpus_personal_data_consent_txt
INFO router_auto_decision=rules_confident intent=delivery conf=0.85 allowed_tags=legalization rule=delivery_keywords
INFO HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO llm_router_rationale=The question pertains to the distinction between apostille and legalization, which aligns with the apostille intent and relevant tags.
INFO Router intent=apostille conf=0.80 rule=llm_router backend=llm allowed_tags=china,faq,legalization shortlisted=rag_corpus_main_page_txt,rag_corpus_personal_data_consent_txt top_score=0.551
INFO Router trace backend_requested=llm selected_backend=llm rules_confident=True shortlist=2 top_doc_score=0.551 top2_doc_score=0.613 filter_warning=False fallback_reasons=none
What documents apply to apostille vs legalization?      llm     llm     apostille       0.80    china,faq,legalization  rag_corpus_main_page_txt,rag_corpus_personal_data_consent_txt
INFO router_auto_decision=rules_confident intent=contact conf=0.90 allowed_tags=contact,hours,locations rule=contact_keywords
INFO Router intent=contact conf=0.90 rule=contact_keywords backend=rules allowed_tags=contact,hours,locations shortlisted=rag_corpus_consulate_contacts_txt,rag_corpus_contacts_txt top_score=0.855
INFO Router trace backend_requested=rules selected_backend=rules rules_confident=True shortlist=2 top_doc_score=0.855 top2_doc_score=0.550 filter_warning=False fallback_reasons=none
In China whatsapp is blocked. Could I contact you on wechat there?      rules   rules   contact 0.90    contact,hours,locations rag_corpus_consulate_contacts_txt,rag_corpus_contacts_txt
INFO router_auto_decision=rules_confident intent=contact conf=0.90 allowed_tags=contact,hours,locations rule=contact_keywords
INFO Router intent=contact conf=0.90 rule=contact_keywords backend=rules allowed_tags=contact,hours,locations shortlisted=rag_corpus_consulate_contacts_txt,rag_corpus_contacts_txt top_score=0.855
INFO Router trace backend_requested=auto selected_backend=rules rules_confident=True shortlist=2 top_doc_score=0.855 top2_doc_score=0.550 filter_warning=False fallback_reasons=none
In China whatsapp is blocked. Could I contact you on wechat there?      auto    rules   contact 0.90    contact,hours,locations rag_corpus_consulate_contacts_txt,rag_corpus_contacts_txt
INFO router_auto_decision=rules_confident intent=contact conf=0.90 allowed_tags=contact,hours,locations rule=contact_keywords
INFO HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO llm_router_rationale=The question is about contacting the service via WeChat in China, which falls under the contact intent.
INFO Router intent=contact conf=0.90 rule=llm_router backend=llm allowed_tags=contact,hours,locations shortlisted=rag_corpus_consulate_contacts_txt,rag_corpus_contacts_txt top_score=0.855
INFO Router trace backend_requested=llm selected_backend=llm rules_confident=True shortlist=2 top_doc_score=0.855 top2_doc_score=0.550 filter_warning=False fallback_reasons=none
In China whatsapp is blocked. Could I contact you on wechat there?      llm     llm     contact 0.90    contact,hours,locations rag_corpus_consulate_contacts_txt,rag_corpus_contacts_txt
INFO router_auto_decision=rules_confident intent=contact conf=0.90 allowed_tags=contact,hours,locations rule=contact_keywords
INFO Router intent=contact conf=0.90 rule=contact_keywords backend=rules allowed_tags=contact,hours,locations shortlisted=rag_corpus_contacts_txt,rag_corpus_consulate_contacts_txt top_score=0.777
INFO Router trace backend_requested=rules selected_backend=rules rules_confident=True shortlist=2 top_doc_score=0.777 top2_doc_score=0.553 filter_warning=False fallback_reasons=none
I'd like to know your wechat contact or id?     rules   rules   contact 0.90    contact,hours,locations rag_corpus_contacts_txt,rag_corpus_consulate_contacts_txt
INFO router_auto_decision=rules_confident intent=contact conf=0.90 allowed_tags=contact,hours,locations rule=contact_keywords
INFO Router intent=contact conf=0.90 rule=contact_keywords backend=rules allowed_tags=contact,hours,locations shortlisted=rag_corpus_contacts_txt,rag_corpus_consulate_contacts_txt top_score=0.777
INFO Router trace backend_requested=auto selected_backend=rules rules_confident=True shortlist=2 top_doc_score=0.777 top2_doc_score=0.553 filter_warning=False fallback_reasons=none
I'd like to know your wechat contact or id?     auto    rules   contact 0.90    contact,hours,locations rag_corpus_contacts_txt,rag_corpus_consulate_contacts_txt
INFO router_auto_decision=rules_confident intent=contact conf=0.90 allowed_tags=contact,hours,locations rule=contact_keywords
INFO HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO llm_router_rationale=The user is asking for contact information, which aligns with the 'contact' intent.
INFO Router intent=contact conf=0.90 rule=llm_router backend=llm allowed_tags=contact,hours,locations shortlisted=rag_corpus_contacts_txt,rag_corpus_consulate_contacts_txt top_score=0.777
INFO Router trace backend_requested=llm selected_backend=llm rules_confident=True shortlist=2 top_doc_score=0.777 top2_doc_score=0.553 filter_warning=False fallback_reasons=none
I'd like to know your wechat contact or id?     llm     llm     contact 0.90    contact,hours,locations rag_corpus_contacts_txt,rag_corpus_consulate_contacts_txt
INFO router_auto_decision=rules_not_confident intent=None conf=0.00 allowed_tags=furniture rule=none
INFO Router intent=none conf=0.00 rule=none backend=rules allowed_tags=furniture shortlisted=rag_corpus_furniture_tour_delivery_containers_txt,rag_corpus_furniture_tour_delivery_txt,rag_corpus_furniture_tour_delivery_weights_csv,rag_corpus_furniture_tour_how_txt,rag_corpus_furniture_tour_faq_txt,rag_corpus_furniture_tour_cost_table_csv,rag_corpus_furniture_tour_cost_duties_csv,rag_corpus_furniture_tour_production_china_txt top_score=0.763
INFO Router trace backend_requested=rules selected_backend=rules rules_confident=False shortlist=8 top_doc_score=0.763 top2_doc_score=0.618 filter_warning=False fallback_reasons=none
What's the container volume I can transport my furniture in?    rules   rules   none    0.00    furniture       rag_corpus_furniture_tour_delivery_containers_txt,rag_corpus_furniture_tour_delivery_txt,rag_corpus_furniture_tour_delivery_weights_csv
INFO router_auto_decision=rules_not_confident intent=None conf=0.00 allowed_tags=furniture rule=none
INFO HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO llm_router_rationale=The question pertains to the volume for transporting furniture, which relates to costs and logistics in the context of a furniture tour.
INFO Router intent=furniture_tour_cost conf=0.80 rule=llm_router backend=llm allowed_tags=china,customs,furniture,prices shortlisted=rag_corpus_furniture_tour_delivery_containers_txt,rag_corpus_furniture_tour_delivery_txt,rag_corpus_furniture_tour_delivery_weights_csv,rag_corpus_furniture_tour_how_txt,rag_corpus_furniture_tour_faq_txt,rag_corpus_furniture_tour_cost_table_csv,rag_corpus_furniture_tour_production_china_txt,rag_corpus_furniture_tour_txt top_score=0.763
INFO Router trace backend_requested=auto selected_backend=llm rules_confident=False shortlist=8 top_doc_score=0.763 top2_doc_score=0.618 filter_warning=False fallback_reasons=none
What's the container volume I can transport my furniture in?    auto    llm     furniture_tour_cost     0.80    china,customs,furniture,prices  rag_corpus_furniture_tour_delivery_containers_txt,rag_corpus_furniture_tour_delivery_txt,rag_corpus_furniture_tour_delivery_weights_csv
INFO router_auto_decision=rules_not_confident intent=None conf=0.00 allowed_tags=furniture rule=none
INFO HTTP Request: POST https://api.openai.com/v1/chat/completions "HTTP/1.1 200 OK"
INFO llm_router_rationale=The question relates to the transportation of furniture, which aligns with the furniture tour cost intent.
INFO Router intent=furniture_tour_cost conf=0.80 rule=llm_router backend=llm allowed_tags=china,customs,furniture,prices shortlisted=rag_corpus_furniture_tour_delivery_containers_txt,rag_corpus_furniture_tour_delivery_txt,rag_corpus_furniture_tour_delivery_weights_csv,rag_corpus_furniture_tour_how_txt,rag_corpus_furniture_tour_faq_txt,rag_corpus_furniture_tour_cost_table_csv,rag_corpus_furniture_tour_production_china_txt,rag_corpus_furniture_tour_txt top_score=0.763
INFO Router trace backend_requested=llm selected_backend=llm rules_confident=False shortlist=8 top_doc_score=0.763 top2_doc_score=0.618 filter_warning=False fallback_reasons=none
What's the container volume I can transport my furniture in?    llm     llm     furniture_tour_cost     0.80    china,customs,furniture,prices  rag_corpus_furniture_tour_delivery_containers_txt,rag_corpus_furniture_tour_delivery_txt,rag_corpus_furniture_tour_delivery_weights_csv